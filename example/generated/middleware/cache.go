// This file was automatically generated by "microgen 0.8.0alpha" utility.
// Please, do not edit.
package middleware

import (
	context "context"
	generated "github.com/devimteam/microgen/example/generated"
	entity "github.com/devimteam/microgen/example/svc/entity"
	log "github.com/go-kit/kit/log"
)

// Cache
type Cache interface {
	Set(key, value interface{}) (err error)
	Get(key interface{}) (value interface{}, err error)
}

func ServiceCache(cache Cache) Middleware {
	return func(next generated.StringService) generated.StringService {
		return &serviceCache{
			cache: cache,
			next:  next,
		}
	}
}

type serviceCache struct {
	cache  Cache
	logger log.Logger
	next   generated.StringService
}

func (C *serviceCache) Uppercase(arg0 context.Context, arg1 map[string]string) (res0 string, res1 error) {
	value, e := C.cache.Get("Uppercase")
	if e == nil {
		return value.(*uppercaseResponseCacheEntity).Ans, res1
	}
	defer func() {
		C.cache.Set("Uppercase", &uppercaseResponseCacheEntity{Ans: res0})
	}()
	return C.next.Uppercase(arg0, arg1)
}

func (C *serviceCache) Count(arg0 context.Context, arg1 string, arg2 string) (res0 int, res1 []int, res2 error) {
	value, e := C.cache.Get(arg1)
	if e == nil {
		return value.(*countResponseCacheEntity).Count, value.(*countResponseCacheEntity).Positions, res2
	}
	defer func() {
		C.cache.Set(arg1, &countResponseCacheEntity{
			Count:     res0,
			Positions: res1,
		})
	}()
	return C.next.Count(arg0, arg1, arg2)
}

func (C *serviceCache) TestCase(arg0 context.Context, arg1 []*entity.Comment) (res0 map[string]int, res1 error) {
	return C.next.TestCase(arg0, arg1)
}

type uppercaseResponseCacheEntity struct {
	Ans string
}

type countResponseCacheEntity struct {
	Count     int
	Positions []int
}

type testCaseResponseCacheEntity struct {
	Tree map[string]int
}
